<!doctype html><html lang=en dir=ltr class=scroll-smooth data-default-appearance=dark data-auto-appearance=false><head><meta charset=utf-8><meta http-equiv=content-language content="en"><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="ie=edge"><title>Sigma Python #1: Decorators &#183; tobiwan.dev</title>
<meta name=title content="Sigma Python #1: Decorators &#183; tobiwan.dev"><meta name=description content="My personal website and blog about backend engineering"><meta name=keywords content="python,"><link rel=canonical href=https://tobiwandev.github.io/articles/sigmapython01/><link type=text/css rel=stylesheet href=/css/main.bundle.min.2fc9a195f18e79537904f0ee44059e796aa8be90aec87400dca3e8ba3813579310441618e1e95e003772f96c99c6449a4382a01c63836e5aa4e5b1d0d6b5045e.css integrity="sha512-L8mhlfGOeVN5BPDuRAWeeWqovpCuyHQA3KPoujgTV5MQRBYY4eleADdy+WyZxkSaQ4KgHGODblqk5bHQ1rUEXg=="><script type=text/javascript src=/js/appearance.min.516a16745bea5a9bd011138d254cc0fd3973cd55ce6e15f3dec763e7c7c2c7448f8fe7b54cca811cb821b0c7e12cd161caace1dd794ac3d34d40937cbcc9ee12.js integrity="sha512-UWoWdFvqWpvQERONJUzA/TlzzVXObhXz3sdj58fCx0SPj+e1TMqBHLghsMfhLNFhyqzh3XlKw9NNQJN8vMnuEg=="></script><script defer type=text/javascript id=script-bundle src=/js/main.bundle.min.7ee3d0153e96d78a28093d1c97e8a649b6de332eeb66d2c28a48d1afcba0d47a6e7c45dc76a5c9c732c97307593e103bbb0f5fce2f2dab0efb6d411d63064c37.js integrity="sha512-fuPQFT6W14ooCT0cl+imSbbeMy7rZtLCikjRr8ug1HpufEXcdqXJxzLJcwdZPhA7uw9fzi8tqw77bUEdYwZMNw==" data-copy data-copied></script><script src=/js/zoom.min.js></script><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><meta property="og:url" content="https://tobiwandev.github.io/articles/sigmapython01/"><meta property="og:site_name" content="tobiwan.dev"><meta property="og:title" content="Sigma Python #1: Decorators"><meta property="og:description" content="One of the most interesting and useful features of Python are decorators, which are callable objects that modify the behavior of other pieces of code without any additional changes. Decorators are a fundamental concept in Python, and they are used extensively in the language’s standard library, as well as in third-party libraries and frameworks.
Some of the most common usages of decorators include:
logging timing caching error handling Decorators are also a great way to create reusable code since they can be applied to multiple functions."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="articles"><meta property="article:published_time" content="2023-03-17T00:00:00+00:00"><meta property="article:modified_time" content="2023-03-17T00:00:00+00:00"><meta property="article:tag" content="Python"><meta property="og:image" content="https://tobiwandev.github.io/articles/sigmapython01/featured.png"><meta property="og:see_also" content="https://tobiwandev.github.io/articles/sigmapython03/"><meta property="og:see_also" content="https://tobiwandev.github.io/articles/sigmapython02/"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://tobiwandev.github.io/articles/sigmapython01/featured.png"><meta name=twitter:title content="Sigma Python #1: Decorators"><meta name=twitter:description content="One of the most interesting and useful features of Python are decorators, which are callable objects that modify the behavior of other pieces of code without any additional changes. Decorators are a fundamental concept in Python, and they are used extensively in the language’s standard library, as well as in third-party libraries and frameworks.
Some of the most common usages of decorators include:
logging timing caching error handling Decorators are also a great way to create reusable code since they can be applied to multiple functions."><script type=application/ld+json>[{"@context":"https://schema.org","@type":"Article","articleSection":"Articles","name":"Sigma Python #1: Decorators","headline":"Sigma Python #1: Decorators","abstract":"One of the most interesting and useful features of Python are decorators, which are callable objects that modify the behavior of other pieces of code without any additional changes. Decorators are a fundamental concept in Python, and they are used extensively in the language\u0026rsquo;s standard library, as well as in third-party libraries and frameworks.\nSome of the most common usages of decorators include:\nlogging timing caching error handling Decorators are also a great way to create reusable code since they can be applied to multiple functions.","inLanguage":"en","url":"https:\/\/tobiwandev.github.io\/articles\/sigmapython01\/","author":{"@type":"Person","name":"Piotr Tobiasz"},"copyrightYear":"2023","dateCreated":"2023-03-17T00:00:00\u002b00:00","datePublished":"2023-03-17T00:00:00\u002b00:00","dateModified":"2023-03-17T00:00:00\u002b00:00","keywords":["python"],"mainEntityOfPage":"true","wordCount":"2847"}]</script><meta name=author content="Piotr Tobiasz"><link href=mailto:piotr.tobiasz.it@gmail.com rel=me><link href=https://github.com/tobiwandev rel=me><link href=https://linkedin.com/in/piotr-tobiasz-dev rel=me><link href=https://twitter.com/tobias_piotr rel=me><link href=https://chaoticengineer.substack.com rel=me><script src=/lib/jquery/jquery.slim.min.js integrity></script><meta name=theme-color></head><body class="flex flex-col h-screen px-6 m-auto text-lg leading-7 max-w-7xl bg-neutral text-neutral-900 dark:bg-neutral-800 dark:text-neutral sm:px-14 md:px-24 lg:px-32"><div id=the-top class="absolute flex self-center"><a class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 focus:translate-y-0 dark:bg-neutral-600" href=#main-content><span class="font-bold text-primary-600 ltr:pr-2 rtl:pl-2 dark:text-primary-400">&darr;</span>Skip to main content</a></div><div class=min-h-[148px]></div><div class="fixed inset-x-0 pl-[24px] pr-[24px]" style=z-index:100><div id=menu-blur class="absolute opacity-0 inset-x-0 top-0 h-full single_hero_background nozoom backdrop-blur-2xl shadow-2xl"></div><div class="relative max-w-[64rem] ml-auto mr-auto"><div style=padding-left:0;padding-right:0;padding-top:2px;padding-bottom:3px class="main-menu flex items-center justify-between px-4 py-6 sm:px-6 md:justify-start space-x-3"><div><a href=/ class=flex><span class=sr-only>tobiwan.dev</span>
<img src=/img/keanu.png width=25 height=25 class="logo max-h-[5rem] max-w-[5rem] object-scale-down object-left nozoom" alt=tobiwan.dev></a></div><div class="flex flex-1 items-center justify-between"><nav class="flex space-x-3"><a href=/ class="text-base font-medium text-gray-500 hover:text-gray-900">tobiwan.dev</a></nav><nav class="hidden md:flex items-center space-x-5 md:ml-12 h-12"><a href=/articles/ class="flex items-center"><p class="text-base font-medium text-gray-500 hover:text-gray-900" title>Articles</p></a><a href=/about/ class="flex items-center"><p class="text-base font-medium text-gray-500 hover:text-gray-900" title>About</p></a><button id=search-button aria-label=Search class="text-base hover:text-primary-600 dark:hover:text-primary-400 h-12" title>
<span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></button><div class="ltr:mr-14 rtl:ml-14 cursor-pointer text-sm text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400"><button id=appearance-switcher aria-label="Dark mode switcher" type=button><div class="flex items-center justify-center h-12 dark:hidden"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M32 256C32 132.2 132.3 32 255.8 32c11.36.0 29.7 1.668 40.9 3.746 9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3 9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480 132.1 480 32 379.6 32 256z"/></svg></span></div><div class="items-center justify-center hidden h-12 dark:flex"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M256 159.1c-53.02.0-95.1 42.98-95.1 95.1s41.2 96.9 95.1 96.9 95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347l-63.2-91.9 63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89 164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6 12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256 2.74 347.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7 19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109 109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69.0-127.1-57.31-127.1-127.1.0-70.69 57.31-127.1 127.1-127.1S383.1 186.2 383.1 256c0 70.7-56.4 127.1-127.1 127.1z"/></svg></span></div></button></div></nav><div class="flex md:hidden items-center space-x-5 md:ml-12"><span></span>
<button id=search-button-mobile aria-label=Search class="text-base hover:text-primary-600 dark:hover:text-primary-400" title>
<span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>
</span></button>
<button id=appearance-switcher-mobile aria-label="Dark mode switcher" type=button style=margin-right:5px><div class="flex items-center justify-center h-12 dark:hidden"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M32 256C32 132.2 132.3 32 255.8 32c11.36.0 29.7 1.668 40.9 3.746 9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3 9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480 132.1 480 32 379.6 32 256z"/></svg></span></div><div class="items-center justify-center hidden h-12 dark:flex"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M256 159.1c-53.02.0-95.1 42.98-95.1 95.1s41.2 96.9 95.1 96.9 95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347l-63.2-91.9 63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89 164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6 12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256 2.74 347.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7 19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109 109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69.0-127.1-57.31-127.1-127.1.0-70.69 57.31-127.1 127.1-127.1S383.1 186.2 383.1 256c0 70.7-56.4 127.1-127.1 127.1z"/></svg></span></div></button></div></div><div class="-my-2 -mr-2 md:hidden"><label id=menu-button for=menu-controller class=block><input type=checkbox id=menu-controller class=hidden><div class="cursor-pointer hover:text-primary-600 dark:hover:text-primary-400"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentcolor" d="M0 96C0 78.33 14.33 64 32 64H416c17.7.0 32 14.33 32 32 0 17.7-14.3 32-32 32H32C14.33 128 0 113.7.0 96zM0 256c0-17.7 14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32H32c-17.67.0-32-14.3-32-32zM416 448H32c-17.67.0-32-14.3-32-32s14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32z"/></svg></span></div><div id=menu-wrapper style=padding-top:5px class="fixed inset-0 z-30 invisible w-screen h-screen m-0 overflow-auto transition-opacity opacity-0 cursor-default bg-neutral-100/50 backdrop-blur-sm dark:bg-neutral-900/50"><ul class="flex space-y-2 mt-3 flex-col items-end w-full px-6 py-6 mx-auto overflow-visible list-none ltr:text-right rtl:text-left max-w-7xl"><li><span class="cursor-pointer inline-block align-text-bottom hover:text-primary-600 dark:hover:text-primary-400"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentcolor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></span></li><li class=mt-1><a href=/articles/ class="flex items-center"><p class="text-bg font-bg text-gray-500 hover:text-gray-900" title>Articles</p></a></li><li class=mt-1><a href=/about/ class="flex items-center"><p class="text-bg font-bg text-gray-500 hover:text-gray-900" title>About</p></a></li></ul></div></label></div></div></div></div><script>window.addEventListener("scroll",function(){var t=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0,n=document.getElementById("menu-blur");n.style.opacity=t/300})</script><div class="relative flex flex-col grow"><main id=main-content class=grow><article><div id=hero class="h-[150px] md:h-[200px]"></div><div class="fixed inset-x-0 top-0 h-[800px] single_hero_background nozoom" style=background-image:url(/articles/sigmapython01/featured_hued2312237d32c4777a3b48a275d0c915_1073653_1200x0_resize_box_3.png)><div class="absolute inset-0 bg-gradient-to-t from-neutral dark:from-neutral-800 to-transparent mix-blend-normal"></div><div class="absolute inset-0 opacity-60 bg-gradient-to-t from-neutral dark:from-neutral-800 to-neutral-100 dark:to-neutral-800 mix-blend-normal"></div></div><div id=background-blur class="fixed opacity-0 inset-x-0 top-0 h-full single_hero_background nozoom backdrop-blur-2xl"></div><script>window.addEventListener("scroll",function(){var t=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0,n=document.getElementById("background-blur");n.style.opacity=t/300})</script><header id=single_header class="mt-5 max-w-prose"><ol class="text-sm text-neutral-500 dark:text-neutral-400 print:hidden"><li class="inline hidden"><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/>tobiwan.dev</a><span class="px-1 text-primary-500">/</span></li><li class=inline><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/articles/>Articles</a><span class="px-1 text-primary-500">/</span></li><li class="inline hidden"><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/articles/sigmapython01/>Sigma Python #1: Decorators</a><span class="px-1 text-primary-500">/</span></li></ol><h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">Sigma Python #1: Decorators</h1><div class="mt-1 mb-6 text-base text-neutral-500 dark:text-neutral-400 print:hidden"><div style=cursor:default class="flex flex-row flex-wrap items-center"><time datetime="2023-03-17 00:00:00 +0000 UTC">17 March 2023</time><span class="px-2 text-primary-500">&#183;</span><span>2847 words</span><span class="px-2 text-primary-500">&#183;</span><span title="Reading time">14 mins</span></div><div style=cursor:pointer class="flex flex-row flex-wrap items-center"><span style=margin-top:.5rem class=mr-2 onclick='window.open("/tags/python/","_self")'><span class=flex><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Python</span></span></span></div></div><div class=flex><img class="!mt-0 !mb-0 h-24 w-24 rounded-full ltr:mr-4 rtl:ml-4" width=96 height=96 alt="Piotr Tobiasz" src=/img/profile_hu4018d304b93d79db2eb11962f1115f33_3184506_192x192_fill_box_smart1_3.png><div class=place-self-center><div class="text-[0.6rem] uppercase leading-3 text-neutral-500 dark:text-neutral-400">Author</div><div class="font-semibold leading-6 text-neutral-800 dark:text-neutral-300">Piotr Tobiasz</div><div class="text-sm text-neutral-700 dark:text-neutral-400">Engineering enjoyer, doing backend stuff with Go and Python</div><div class="text-2xl sm:text-lg"><div class="flex flex-wrap text-neutral-400 dark:text-neutral-500"><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=mailto:piotr.tobiasz.it@gmail.com target=_blank aria-label=Email rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M207.8 20.73c-93.45 18.32-168.7 93.66-187 187.1-27.64 140.9 68.65 266.2 199.1 285.1 19.01 2.888 36.17-12.26 36.17-31.49l1e-4-.6631c0-15.74-11.44-28.88-26.84-31.24-84.35-12.98-149.2-86.13-149.2-174.2.0-102.9 88.61-185.5 193.4-175.4 91.54 8.869 158.6 91.25 158.6 183.2v16.16c0 22.09-17.94 40.05-40 40.05s-40.01-17.96-40.01-40.05v-120.1c0-8.847-7.161-16.02-16.01-16.02l-31.98.0036c-7.299.0-13.2 4.992-15.12 11.68-24.85-12.15-54.24-16.38-86.06-5.106-38.75 13.73-68.12 48.91-73.72 89.64-9.483 69.01 43.81 128 110.9 128 26.44.0 50.43-9.544 69.59-24.88 24 31.3 65.23 48.69 109.4 37.49C465.2 369.3 496 324.1 495.1 277.2V256.3c0-149.2-133.9-265.632-287.3-235.57zM239.1 304.3c-26.47.0-48-21.56-48-48.05s21.53-48.05 48-48.05 48 21.56 48 48.05-20.6 48.05-48 48.05z"/></svg>
</span></span></a><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://github.com/tobiwandev target=_blank aria-label=Github rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentcolor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
</span></span></a><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://linkedin.com/in/piotr-tobiasz-dev target=_blank aria-label=Linkedin rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentcolor" d="M416 32H31.9C14.3 32 0 46.5.0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6.0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3.0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2.0 38.5 17.3 38.5 38.5.0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6.0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2.0 79.7 44.3 79.7 101.9V416z"/></svg>
</span></span></a><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://twitter.com/tobias_piotr target=_blank aria-label=Twitter rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M459.37 151.716c.325 4.548.325 9.097.325 13.645.0 138.72-105.583 298.558-298.558 298.558-59.452.0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055.0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421.0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391.0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04.0-57.828 46.782-104.934 104.934-104.934 30.213.0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
</span></span></a><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://chaoticengineer.substack.com target=_blank aria-label=Substack rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 511.471"><path fill="currentcolor" d="M0 0h448v62.804H0V0zm0 229.083h448v282.388L223.954 385.808.0 511.471V229.083zm0-114.542h448v62.804H0v-62.804z"/></svg></span></span></a></div></div></div></div><div class=mb-5></div></header><section class="flex flex-col max-w-full mt-0 prose dark:prose-invert lg:flex-row"><div class="order-first sm:max-w-prose lg:ml-auto px-0 lg:order-last lg:max-w-xs ltr:lg:pl-8 rtl:lg:pr-8"><div class="toc ltr:pl-5 rtl:pr-5 print:hidden lg:sticky lg:top-[140px]"><details open class="mt-0 overflow-hidden rounded-lg ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 hidden lg:block"><summary class="block py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">Table of Contents</summary><div class="min-w-[220px] py-2 border-dotted border-neutral-300 ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600"><nav id=TableOfContents><ul><li><a href=#anatomy-of-a-decorator>Anatomy of a decorator</a></li><li><a href=#closures>Closures</a></li><li><a href=#parametrization>Parametrization</a></li><li><a href=#class-based-decorators>Class-based decorators</a></li><li><a href=#advanced-scenario>Advanced scenario</a></li><li><a href=#summary>Summary</a></li><li><a href=#sources>Sources</a></li></ul></nav></div></details><details class="mt-0 overflow-hidden rounded-lg ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 lg:hidden"><summary class="py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">Table of Contents</summary><div class="py-2 border-dotted border-neutral-300 ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600"><nav id=TableOfContents><ul><li><a href=#anatomy-of-a-decorator>Anatomy of a decorator</a></li><li><a href=#closures>Closures</a></li><li><a href=#parametrization>Parametrization</a></li><li><a href=#class-based-decorators>Class-based decorators</a></li><li><a href=#advanced-scenario>Advanced scenario</a></li><li><a href=#summary>Summary</a></li><li><a href=#sources>Sources</a></li></ul></nav></div></details></div></div><div class="min-w-0 min-h-0 max-w-fit"><details style=margin-left:0 class="mt-2 mb-5 overflow-hidden rounded-lg ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5"><summary class="py-1 text-lg font-semibold cursor-pointer bg-primary-200 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-primary-800 dark:text-neutral-100">Sigma Python - This article is part of a series.</summary></details><div class="max-w-prose mb-20"><p>One of the most interesting and useful features of Python are decorators, which are callable objects that modify the behavior of other pieces of code without any additional changes. Decorators are a fundamental concept in Python, and they are used extensively in the language&rsquo;s standard library, as well as in third-party libraries and frameworks.</p><p>Some of the most common usages of decorators include:</p><ul><li>logging</li><li>timing</li><li>caching</li><li>error handling</li></ul><p>Decorators are also a great way to create reusable code since they can be applied to multiple functions.</p><p>This article explores the topic of Python decorators, including their following aspects:</p><ul><li>structure</li><li>behavior</li><li>closures</li><li>parametrization</li><li>class-based implementation</li></ul><p>Each section offers simple code examples related to a specific subject, with one more complex and practical example concluding the article in the last section.</p><p>Whether you are a beginner or an experienced Python programmer, understanding decorators is essential for writing clean, concise, and maintainable code. By the end of this article, you will have a solid understanding of Python decorators and be able to use them in your own code to improve its functionality and readability.</p><h2 class="relative group">Anatomy of a decorator<div id=anatomy-of-a-decorator class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#anatomy-of-a-decorator aria-label=Anchor>#</a></span></h2><p>A decorator, as previously said, is a piece of code that adds or modifies the functionality of another piece of code. Such behavior is achieved by creating either a function or a class that accepts an existing function as a parameter and &lsquo;decorates&rsquo; it. The following example shows a simple decorator and two ways to decorate a function:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> typing <span style=color:#f92672>import</span> Any, Callable
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>announcer</span>(func: Callable[<span style=color:#f92672>...</span>, Any]) <span style=color:#f92672>-&gt;</span> Callable[<span style=color:#f92672>...</span>, Any]:
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Decorating </span><span style=color:#e6db74>{</span>func<span style=color:#f92672>.</span>__name__<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>wrapper</span>(<span style=color:#f92672>*</span>args, <span style=color:#f92672>**</span>kwargs) <span style=color:#f92672>-&gt;</span> Any:
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Calling </span><span style=color:#e6db74>{</span>func<span style=color:#f92672>.</span>__name__<span style=color:#e6db74>}</span><span style=color:#e6db74> with </span><span style=color:#e6db74>{</span>args<span style=color:#e6db74>}</span><span style=color:#e6db74> and </span><span style=color:#e6db74>{</span>kwargs<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>        result <span style=color:#f92672>=</span> func(<span style=color:#f92672>*</span>args, <span style=color:#f92672>**</span>kwargs)
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;The result is </span><span style=color:#e6db74>{</span>result<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> result
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> wrapper
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@announcer</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>to_fahrenheit</span>(celsius: float) <span style=color:#f92672>-&gt;</span> float:
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> (celsius <span style=color:#f92672>*</span> <span style=color:#ae81ff>1.8</span>) <span style=color:#f92672>+</span> <span style=color:#ae81ff>32</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>to_celsius</span>(fahrenheit: float) <span style=color:#f92672>-&gt;</span> float:
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> (fahrenheit <span style=color:#f92672>-</span> <span style=color:#ae81ff>32</span>) <span style=color:#f92672>/</span> <span style=color:#ae81ff>1.8</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>to_celsius <span style=color:#f92672>=</span> announcer(to_celsius)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> __name__ <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;__main__&#34;</span>:
</span></span><span style=display:flex><span>    to_fahrenheit(<span style=color:#ae81ff>42.0</span>)
</span></span><span style=display:flex><span>    to_fahrenheit(celsius<span style=color:#f92672>=</span><span style=color:#ae81ff>11.0</span>)
</span></span><span style=display:flex><span>    to_celsius(<span style=color:#ae81ff>452.0</span>)
</span></span><span style=display:flex><span>    to_celsius(fahrenheit<span style=color:#f92672>=</span><span style=color:#ae81ff>111.0</span>)
</span></span></code></pre></div><p><code>announcer</code> is a decorator that replaces the decorated function with a new function that takes the following steps:</p><ol><li>Prints the name of called function and passed arguments.</li><li>Calls the decorated function and saves the result.</li><li>Prints and returns the result.</li></ol><p>Executing the preceding code yields the following result:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-plaintext data-lang=plaintext><span style=display:flex><span>Decorating to_fahrenheit
</span></span><span style=display:flex><span>Decorating to_celsius
</span></span><span style=display:flex><span>Calling to_fahrenheit with (42,) and {}
</span></span><span style=display:flex><span>The result is 107.60000000000001
</span></span><span style=display:flex><span>Calling to_fahrenheit with () and {&#39;celsius&#39;: 11}
</span></span><span style=display:flex><span>The result is 51.8
</span></span><span style=display:flex><span>Calling to_celsius with (452,) and {}
</span></span><span style=display:flex><span>The result is 233.33333333333331
</span></span><span style=display:flex><span>Calling to_celsius with () and {&#39;fahrenheit&#39;: 111}
</span></span><span style=display:flex><span>The result is 43.888888888888886
</span></span></code></pre></div><p>The output reveals that <code>wrapper</code> function from the decorator replaced both <code>to_fahrenheit</code> and <code>to_celsius</code> functions. On top of the calculations happening in the initial implementation, the functions now make the <code>print</code> calls added in the decorator.</p><p>It is also worth noticing when the first two prints actually appear. Even if both <code>to_fahrenheit</code> and <code>to_celsius</code> were removed, those two prints would still be present. This is because decorators are being called at the import time. When you consider how <code>to_celsius</code> is decorated, where the <code>announcer</code> decorator is explicitly called, it makes a lot of sense.</p><p>One caveat that isn&rsquo;t visible in the output is what both decorated functions actually became and how IDE (like VSCode or PyCharm) might be reacting to them afterward. Considering the following changes to the previous code:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>if</span> __name__ <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;__main__&#34;</span>:
</span></span><span style=display:flex><span>    print(to_fahrnheit)
</span></span><span style=display:flex><span>    print(to_fahrenheit<span style=color:#f92672>.</span>__annotations__)
</span></span><span style=display:flex><span>    print(to_celsius)
</span></span><span style=display:flex><span>    print(to_celsius<span style=color:#f92672>.</span>__annotations__)
</span></span></code></pre></div><p>Now, the outcome is as follows:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-plaintext data-lang=plaintext><span style=display:flex><span>Decorating to_fahrenheit
</span></span><span style=display:flex><span>Decorating to_celsius
</span></span><span style=display:flex><span>&lt;function announcer.&lt;locals&gt;.wrapper at 0x7f452835a7a0&gt;
</span></span><span style=display:flex><span>{&#39;return&#39;: typing.Any}
</span></span><span style=display:flex><span>&lt;function announcer.&lt;locals&gt;.wrapper at 0x7f452821aa70&gt;
</span></span><span style=display:flex><span>{&#39;return&#39;: typing.Any}
</span></span></code></pre></div><p>The output now may be unexpected, and it also reveals a larger issue: decorated functions were not only &rsquo;enriched&rsquo; with new features, but they were actually replaced by the decorator&rsquo;s <code>wrapper</code> function. In this context, &lsquo;replaced&rsquo; means that any information about the initial function, such as name or type annotations, is gone. That is why your IDE may be unable to assist you with autocompletion while dealing with decorated functions. Code just does not include the necessary information any longer.</p><p>While you could manually add all the necessary information to the wrapper function, there is a built-in solution to address this problem:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> functools
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>announcer</span>(func: Callable[<span style=color:#f92672>...</span>, Any]) <span style=color:#f92672>-&gt;</span> Callable[<span style=color:#f92672>...</span>, Any]:
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Decorating </span><span style=color:#e6db74>{</span>func<span style=color:#f92672>.</span>__name__<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@functools.wraps</span>(func)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>wrapper</span>(<span style=color:#f92672>*</span>args, <span style=color:#f92672>**</span>kwargs) <span style=color:#f92672>-&gt;</span> Any:
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Calling </span><span style=color:#e6db74>{</span>func<span style=color:#f92672>.</span>__name__<span style=color:#e6db74>}</span><span style=color:#e6db74> with </span><span style=color:#e6db74>{</span>args<span style=color:#e6db74>}</span><span style=color:#e6db74> and </span><span style=color:#e6db74>{</span>kwargs<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>        result <span style=color:#f92672>=</span> func(<span style=color:#f92672>*</span>args, <span style=color:#f92672>**</span>kwargs)
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;The result is </span><span style=color:#e6db74>{</span>result<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> result
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> wrapper
</span></span></code></pre></div><p><code>functools</code> is a Python standard library that contains several high-order functions – ones that are used for modifying existing functions. <code>wraps</code> is a decorator that accepts the decorated function as an argument and then updates the wrapper that was meant to replace the original function. Under the hood, <code>wraps</code> invokes the <code>update_wrapper</code> function, which provides probably the clearest description of this process:</p><blockquote><p>Update a wrapper function to look like the wrapped function</p></blockquote><p>With these <code>announcer</code> changes in place, the output now is the following:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-plaintext data-lang=plaintext><span style=display:flex><span>Decorating to_fahrenheit
</span></span><span style=display:flex><span>Decorating to_celsius
</span></span><span style=display:flex><span>&lt;function to_fahrenheit at 0x7f540e3ae7a0&gt;
</span></span><span style=display:flex><span>{&#39;celsius&#39;: &lt;class &#39;float&#39;&gt;, &#39;return&#39;: &lt;class &#39;float&#39;&gt;}
</span></span><span style=display:flex><span>&lt;function to_celsius at 0x7f540e26ea70&gt;
</span></span><span style=display:flex><span>{&#39;fahrenheit&#39;: &lt;class &#39;float&#39;&gt;, &#39;return&#39;: &lt;class &#39;float&#39;&gt;}
</span></span></code></pre></div><p>In this case, <code>wrapper</code> function from the decorator still replaces the decorated functions, but now it contains all the essential information copied from the initial function.</p><p>Next comes the topic of free variables and closures, so how decorated functions are able to &lsquo;share state&rsquo; between themselves.</p><h2 class="relative group">Closures<div id=closures class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#closures aria-label=Anchor>#</a></span></h2><p>Take a look back at the very first example and its output. If the wrapper function replaced the decorated functions, then how did it still have access to their original names? You can see it did in the first <code>print</code> call in the <code>wrapper</code>. To make it more clear, consider the following example:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> typing <span style=color:#f92672>import</span> Any, Callable
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>register</span>(func: Callable[<span style=color:#f92672>...</span>, Any]) <span style=color:#f92672>-&gt;</span> Callable[<span style=color:#f92672>...</span>, Any]:
</span></span><span style=display:flex><span>    results <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>wrapper</span>(<span style=color:#f92672>*</span>args, <span style=color:#f92672>**</span>kwargs) <span style=color:#f92672>-&gt;</span> Any:
</span></span><span style=display:flex><span>        result <span style=color:#f92672>=</span> func(<span style=color:#f92672>*</span>args, <span style=color:#f92672>**</span>kwargs)
</span></span><span style=display:flex><span>        results<span style=color:#f92672>.</span>append(result)
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Results: </span><span style=color:#e6db74>{</span>results<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> result
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> wrapper
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@register</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>to_fahrenheit</span>(celsius: float) <span style=color:#f92672>-&gt;</span> float:
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> (celsius <span style=color:#f92672>*</span> <span style=color:#ae81ff>1.8</span>) <span style=color:#f92672>+</span> <span style=color:#ae81ff>32</span>
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> __name__ <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;__main__&#34;</span>:
</span></span><span style=display:flex><span>    to_fahrenheit(<span style=color:#ae81ff>10.0</span>)
</span></span><span style=display:flex><span>    to_fahrenheit(<span style=color:#ae81ff>20.0</span>)
</span></span><span style=display:flex><span>    to_fahrenheit(<span style=color:#ae81ff>30.0</span>)
</span></span></code></pre></div><p>The <code>register</code> decorator stores the results of all the calls that happen on the functions it decorates. Calling this code results in the following output:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-plaintext data-lang=plaintext><span style=display:flex><span>Results: [50.0]
</span></span><span style=display:flex><span>Results: [50.0, 68.0]
</span></span><span style=display:flex><span>Results: [50.0, 68.0, 86.0]
</span></span></code></pre></div><p>This outcome should come as no surprise, given the code&rsquo;s simplicity. However, another question that may arise is how the <code>wrapper</code> function is able to reach the <code>results</code> variable. The <code>register</code> decorator returns the <code>wrapper</code> function, hence <code>results</code> should be outside its scope. The <code>func</code> variable in the first example was similar in that it belonged to the <code>announcer</code> decorator rather than the <code>wrapper</code> function. That behavior is possible thanks to Python features known as <em>free variables</em> and <em>closures</em>.</p><p>When you create a nested function that references a variable that is neither local nor global, Python creates a <em>closure</em> to bind the variable to the nested function. Such variables are known as <em>free variables</em>, and they are stored in a <code>__closure__</code> attribute. This is particularly common with decorators, where the decorated function is a free variable. To illustrate this on a previous example, consider the following changes:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>if</span> __name__ <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;__main__&#34;</span>:
</span></span><span style=display:flex><span>    to_fahrenheit(<span style=color:#ae81ff>10.0</span>)
</span></span><span style=display:flex><span>    to_fahrenheit(<span style=color:#ae81ff>20.0</span>)
</span></span><span style=display:flex><span>    to_fahrenheit(<span style=color:#ae81ff>30.0</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> cell <span style=color:#f92672>in</span> to_fahrenheit<span style=color:#f92672>.</span>__closure__:
</span></span><span style=display:flex><span>        print(cell<span style=color:#f92672>.</span>cell_contents)
</span></span></code></pre></div><p><code>__closure__</code> attribute contains objects called <em>cells</em> that store the values of free variables in a <code>cell_contents</code> attribute. Here is the output produced by the above code:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-plaintext data-lang=plaintext><span style=display:flex><span>Results: [50.0]
</span></span><span style=display:flex><span>Results: [50.0, 68.0]
</span></span><span style=display:flex><span>Results: [50.0, 68.0, 86.0]
</span></span><span style=display:flex><span>&lt;function to_fahrenheit at 0x7fdca98d1da0&gt;
</span></span><span style=display:flex><span>[50.0, 68.0, 86.0]
</span></span></code></pre></div><p>The last two lines show that the decorated function does, in fact, save the additional values. The original function is the first one – that explains how the <code>wrapper</code> in the first example was able to print the name of the decorated function. The second is the <code>result</code> variable created in the decorator. This demonstrates how powerful feature the closures are: since <code>result</code> is mutable, all the decorated function can share a certain state.</p><p>The next section covers parametrization: how to provide arguments to a decorator before the decoration happens.</p><h2 class="relative group">Parametrization<div id=parametrization class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#parametrization aria-label=Anchor>#</a></span></h2><p>It is fairly common to use a decorator that requires some configuration. One of the most popular examples is the <code>lru_cache</code> decorator from the <code>functools</code> standard library. It is used to cache the output of a decorated function based on its parameters. <code>lru_cache</code> comes with a default configuration, but you can also provide two additional arguments: <code>maxsize</code> and <code>typed</code>. The first indicates how many entries can be cached before the LRU policy begins to remove the oldest items. The latter determines whether the same values of various types should be cached separately. Take a look at this simple example:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> functools <span style=color:#f92672>import</span> lru_cache
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@lru_cache</span>(maxsize<span style=color:#f92672>=</span><span style=color:#ae81ff>2</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>to_fahrenheit</span>(celsius: float) <span style=color:#f92672>-&gt;</span> float:
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Calling to_fahrenheit with </span><span style=color:#e6db74>{</span>celsius<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> (celsius <span style=color:#f92672>*</span> <span style=color:#ae81ff>1.8</span>) <span style=color:#f92672>+</span> <span style=color:#ae81ff>32</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> __name__ <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;__main__&#34;</span>:
</span></span><span style=display:flex><span>    to_fahrenheit(<span style=color:#ae81ff>10.0</span>)
</span></span><span style=display:flex><span>    to_fahrenheit(<span style=color:#ae81ff>20.0</span>)
</span></span><span style=display:flex><span>    to_fahrenheit(<span style=color:#ae81ff>20.0</span>)
</span></span><span style=display:flex><span>    to_fahrenheit(<span style=color:#ae81ff>30.0</span>)
</span></span><span style=display:flex><span>    to_fahrenheit(<span style=color:#ae81ff>40.0</span>)
</span></span><span style=display:flex><span>    to_fahrenheit(<span style=color:#ae81ff>20.0</span>)
</span></span></code></pre></div><p>When <code>maxsize=2</code> is specified, only two results can be cached at the same time. The output of this code is the following:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-plaintext data-lang=plaintext><span style=display:flex><span>Calling to_fahrenheit with 10
</span></span><span style=display:flex><span>Calling to_fahrenheit with 20
</span></span><span style=display:flex><span>Calling to_fahrenheit with 30
</span></span><span style=display:flex><span>Calling to_fahrenheit with 40
</span></span><span style=display:flex><span>Calling to_fahrenheit with 20
</span></span></code></pre></div><p>First, you can see that <code>print</code> with 20 was called just once, despite the fact that <code>to_fahrenheit</code> was called twice with 20 as the argument, indicating that the cache worked. But, at the very end, <code>to_fahrenheit(20.0)</code> didn&rsquo;t use the cache anymore. This is simply because calls with 30 and 40 took all the cache seats, forcing the output of <code>to_fahrenheit(20.0)</code> to be removed.</p><p>This basic example should demonstrate the potential of decorators&rsquo; parametrization: not only you can add functionality to existing code, but you can also configure how it should behave.</p><p>Implementing a decorator that accepts some parameters can be tricky, and the syntax may appear confusing. Consider the following example:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> typing <span style=color:#f92672>import</span> Any, Callable, TypeAlias
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>DecoratedFunc: TypeAlias <span style=color:#f92672>=</span> Callable[<span style=color:#f92672>...</span>, Any]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>retry</span>(max_tries: int <span style=color:#f92672>=</span> <span style=color:#ae81ff>3</span>) <span style=color:#f92672>-&gt;</span> DecoratedFunc:
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>decorator</span>(fn: DecoratedFunc) <span style=color:#f92672>-&gt;</span> DecoratedFunc:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>wrapper</span>(<span style=color:#f92672>*</span>args, <span style=color:#f92672>**</span>kwargs) <span style=color:#f92672>-&gt;</span> Any:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(max_tries):
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>try</span>:
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>return</span> fn(<span style=color:#f92672>*</span>args, <span style=color:#f92672>**</span>kwargs)
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>except</span> <span style=color:#a6e22e>Exception</span> <span style=color:#66d9ef>as</span> exc:
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>if</span> i <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span> <span style=color:#f92672>==</span> max_tries:
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>raise</span> exc
</span></span><span style=display:flex><span>                    print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>{</span>fn<span style=color:#f92672>.</span>__name__<span style=color:#e6db74>}</span><span style=color:#e6db74> failed with </span><span style=color:#e6db74>{</span>exc<span style=color:#e6db74>}</span><span style=color:#e6db74>, retrying&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> wrapper
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> decorator
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@retry</span>(max_tries<span style=color:#f92672>=</span><span style=color:#ae81ff>2</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>to_celsius</span>(fahrenheit: float) <span style=color:#f92672>-&gt;</span> float:
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Calling to_celsius with </span><span style=color:#e6db74>{</span>fahrenheit<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> (fahrenheit <span style=color:#f92672>-</span> <span style=color:#ae81ff>32</span>) <span style=color:#f92672>/</span> <span style=color:#ae81ff>1.8</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> __name__ <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;__main__&#34;</span>:
</span></span><span style=display:flex><span>    to_celsius(<span style=color:#ae81ff>100.0</span>)
</span></span><span style=display:flex><span>    to_celsius(<span style=color:#ae81ff>200.0</span>)
</span></span><span style=display:flex><span>    to_celsius(<span style=color:#e6db74>&#34;300&#34;</span>)
</span></span></code></pre></div><p><code>retry</code> is a simple decorator that causes the decorated function to be called again if something fails inside it. It has a <code>max_tries</code> parameter, which specifies how many times should a decorated function be called before giving up if an exception persists. Here is the output of running the code:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-plaintext data-lang=plaintext><span style=display:flex><span>Calling to_celsius with 100.0
</span></span><span style=display:flex><span>Calling to_celsius with 200.0
</span></span><span style=display:flex><span>Calling to_celsius with 300
</span></span><span style=display:flex><span>to_celsius failed with unsupported operand type(s) for -: &#39;str&#39; and &#39;int&#39;, retrying
</span></span><span style=display:flex><span>Calling to_celsius with 300
</span></span><span style=display:flex><span>Traceback (most recent call last):
</span></span><span style=display:flex><span>  (trunkated error traceback)
</span></span><span style=display:flex><span>  File &#34;/sigma_py/decorators/decorators04.py&#34;, line 31, in to_celsius
</span></span><span style=display:flex><span>    return (fahrenheit - 32) / 1.8
</span></span><span style=display:flex><span>            ~~~~~~~~~~~^~~~
</span></span><span style=display:flex><span>TypeError: unsupported operand type(s) for -: &#39;str&#39; and &#39;int&#39;
</span></span></code></pre></div><p>As you can see, the first two calls worked normally, but the third one triggered the retry mechanism. On the second unsuccessful retry, it gave up and raised the original exception. Of course, these kinds of <code>retry</code> decorators are usually way more sophisticated. The goal here was to test the <code>max_tries</code> parameter in action.</p><p>What can be confusing is how &rsquo;nested&rsquo; the decorator became. The reason is fairly simple: in this case, <code>retry</code> is not actually a decorator, but rather a decorator factory. After receiving the arguments, it returns the decorator, which is the <code>decorator</code> function in this example. The <code>@</code> syntax then decorates the function underneath it. The rest remains the same: wrappers, closures, free variables, and so forth.</p><p>Because <code>max_tries</code> has a default value of 3, you might expect that you could use this decorator without the brackets, i.e., <code>@retry</code>. With this implementation, this is not possible, or at least will not produce the expected outcomes. Since <code>retry</code> is actually a decorator factory, using it without brackets would replace the decorated function with the <code>decorator</code> function. This would of course completely break the program.</p><p>However, it is possible to implement a decorator in a way that it would use the default parameters without the need to call it explicitly. This is done in the final section of the article, where <code>retry</code> decorator is going to be expanded.</p><p>With parametrization covered, the next topic is the implementation of decorators using a class-based approach.</p><h2 class="relative group">Class-based decorators<div id=class-based-decorators class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#class-based-decorators aria-label=Anchor>#</a></span></h2><p>In Python, class instances that implement the <code>__call__</code> method can be invoked just like functions. This means, that it is possible to implement class-based decorators. Even though it doesn&rsquo;t provide any major advantages over the regular, functional approach, it can sometimes be easier to organize the code in a class.</p><p>Here is how the <code>retry</code> decorator from the previous example looks like when implemented as a class:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> typing <span style=color:#f92672>import</span> Any, Callable, TypeAlias
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>DecoratedFunc: TypeAlias <span style=color:#f92672>=</span> Callable[<span style=color:#f92672>...</span>, Any]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Retry</span>:
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> __init__(self, max_tries: int <span style=color:#f92672>=</span> <span style=color:#ae81ff>3</span>) <span style=color:#f92672>-&gt;</span> <span style=color:#66d9ef>None</span>:
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>max_tries <span style=color:#f92672>=</span> max_tries
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> __call__(self, fn: DecoratedFunc) <span style=color:#f92672>-&gt;</span> DecoratedFunc:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>wrapper</span>(<span style=color:#f92672>*</span>args, <span style=color:#f92672>**</span>kwargs) <span style=color:#f92672>-&gt;</span> Any:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(self<span style=color:#f92672>.</span>max_tries):
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>try</span>:
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>return</span> fn(<span style=color:#f92672>*</span>args, <span style=color:#f92672>**</span>kwargs)
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>except</span> <span style=color:#a6e22e>Exception</span> <span style=color:#66d9ef>as</span> exc:
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>if</span> i <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span> <span style=color:#f92672>==</span> self<span style=color:#f92672>.</span>max_tries:
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>raise</span> exc
</span></span><span style=display:flex><span>                    print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>{</span>fn<span style=color:#f92672>.</span>__name__<span style=color:#e6db74>}</span><span style=color:#e6db74> failed with </span><span style=color:#e6db74>{</span>exc<span style=color:#e6db74>}</span><span style=color:#e6db74>, retrying&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> wrapper
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Retry</span>(max_tries<span style=color:#f92672>=</span><span style=color:#ae81ff>2</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>to_celsius</span>(fahrenheit: float) <span style=color:#f92672>-&gt;</span> float:
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Calling to_celsius with </span><span style=color:#e6db74>{</span>fahrenheit<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> (fahrenheit <span style=color:#f92672>-</span> <span style=color:#ae81ff>32</span>) <span style=color:#f92672>/</span> <span style=color:#ae81ff>1.8</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> __name__ <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;__main__&#34;</span>:
</span></span><span style=display:flex><span>    to_celsius(<span style=color:#ae81ff>100.0</span>)
</span></span><span style=display:flex><span>    to_celsius(<span style=color:#ae81ff>200.0</span>)
</span></span><span style=display:flex><span>    to_celsius(<span style=color:#e6db74>&#34;300&#34;</span>)
</span></span></code></pre></div><p>This code produces exactly the same output as the one in the preceding example.</p><p>Similar to the functional approach, calling <code>__init__</code> method of the <code>Retry</code> class is analogous to using a decorator factory. The class instance is then invoked using the <code>__call__</code> method to replace the decorated function with <code>wrapper</code>.</p><p>Using a decorator with a capitalized name might not appear Pythonic, but naming a class using the snake case convention is probably even worse. This can, however, be easily solved by adding a variable that references the class, i.e., <code>retry_that_thing = RetryThatThing</code>. Following that, a class-based decorator looks just like a function.</p><p>The final section goes back to the functional <code>retry</code> decorator in order to make it more powerful and customizable.</p><h2 class="relative group">Advanced scenario<div id=advanced-scenario class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#advanced-scenario aria-label=Anchor>#</a></span></h2><p>The first version of the <code>retry</code> decorator was relatively straightforward. Its updated version includes the following features:</p><ul><li>ability to use the decorator without brackets</li><li>parameter to specify exceptions for which to retry</li><li>parameter to define a callback replacing the final <code>raise</code></li></ul><p>The code for the enriched <code>retry</code> decorator is as follows:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> typing <span style=color:#f92672>import</span> Any, Callable, TypeAlias
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>DecoratedFunc: TypeAlias <span style=color:#f92672>=</span> Callable[<span style=color:#f92672>...</span>, Any]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>retry</span>(
</span></span><span style=display:flex><span>    max_tries: int <span style=color:#f92672>|</span> DecoratedFunc <span style=color:#f92672>=</span> <span style=color:#ae81ff>3</span>,
</span></span><span style=display:flex><span>    exceptions: tuple[type[<span style=color:#a6e22e>Exception</span>], <span style=color:#f92672>...</span>] <span style=color:#f92672>|</span> <span style=color:#66d9ef>None</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>None</span>,
</span></span><span style=display:flex><span>    on_giveup: Callable[[<span style=color:#a6e22e>Exception</span>], <span style=color:#66d9ef>None</span>] <span style=color:#f92672>|</span> <span style=color:#66d9ef>None</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>None</span>,
</span></span><span style=display:flex><span>) <span style=color:#f92672>-&gt;</span> DecoratedFunc:
</span></span><span style=display:flex><span>    <span style=color:#75715e># Catch all exception by default</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> exceptions <span style=color:#f92672>is</span> <span style=color:#66d9ef>None</span>:
</span></span><span style=display:flex><span>        exceptions <span style=color:#f92672>=</span> (<span style=color:#a6e22e>Exception</span>,)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    decorated_func <span style=color:#f92672>=</span> <span style=color:#66d9ef>None</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># If decorator was used without brackets, then function is the first arg</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> callable(max_tries):
</span></span><span style=display:flex><span>        decorated_func, max_tries <span style=color:#f92672>=</span> max_tries, <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>decorator</span>(fn: DecoratedFunc) <span style=color:#f92672>-&gt;</span> DecoratedFunc:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>wrapper</span>(<span style=color:#f92672>*</span>args, <span style=color:#f92672>**</span>kwargs) <span style=color:#f92672>-&gt;</span> Any:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(max_tries):
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>try</span>:
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>return</span> fn(<span style=color:#f92672>*</span>args, <span style=color:#f92672>**</span>kwargs)
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>except</span> exceptions <span style=color:#66d9ef>as</span> exc:
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>if</span> i <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span> <span style=color:#f92672>==</span> max_tries:
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>if</span> on_giveup <span style=color:#f92672>is</span> <span style=color:#66d9ef>None</span>:
</span></span><span style=display:flex><span>                            <span style=color:#66d9ef>raise</span> exc
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>return</span> on_giveup(exc)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                    print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>{</span>fn<span style=color:#f92672>.</span>__name__<span style=color:#e6db74>}</span><span style=color:#e6db74> failed with </span><span style=color:#e6db74>{</span>exc<span style=color:#e6db74>}</span><span style=color:#e6db74>, retrying&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> wrapper
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># If decorated_func is already set, then run decoration immediately</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> decorated_func <span style=color:#f92672>is</span> <span style=color:#f92672>not</span> <span style=color:#66d9ef>None</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> decorator(decorated_func)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> decorator
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@retry</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>to_celsius</span>(fahrenheit: float) <span style=color:#f92672>-&gt;</span> float:
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Calling to_celsius with </span><span style=color:#e6db74>{</span>fahrenheit<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> (fahrenheit <span style=color:#f92672>-</span> <span style=color:#ae81ff>32</span>) <span style=color:#f92672>/</span> <span style=color:#ae81ff>1.8</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@retry</span>(
</span></span><span style=display:flex><span>    max_tries<span style=color:#f92672>=</span><span style=color:#ae81ff>2</span>,
</span></span><span style=display:flex><span>    exceptions<span style=color:#f92672>=</span>(<span style=color:#a6e22e>TypeError</span>,),
</span></span><span style=display:flex><span>    on_giveup<span style=color:#f92672>=</span><span style=color:#66d9ef>lambda</span> exc: print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Giving up: </span><span style=color:#e6db74>{</span>exc<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>),
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>to_fahrenheit</span>(celsius: float) <span style=color:#f92672>-&gt;</span> float:
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Calling to_fahrenheit with </span><span style=color:#e6db74>{</span>celsius<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> (celsius <span style=color:#f92672>*</span> <span style=color:#ae81ff>1.8</span>) <span style=color:#f92672>+</span> <span style=color:#ae81ff>32</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> __name__ <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;__main__&#34;</span>:
</span></span><span style=display:flex><span>    to_celsius(<span style=color:#ae81ff>100.0</span>)
</span></span><span style=display:flex><span>    to_fahrenheit(<span style=color:#ae81ff>40</span>)
</span></span><span style=display:flex><span>    to_fahrenheit(<span style=color:#e6db74>&#34;50&#34;</span>)
</span></span></code></pre></div><p>The <code>retry</code> function now accepts three parameters:</p><ol><li><code>max_tries</code>, which works just as previously</li><li><code>exceptions</code>, which describes what exception classes should be handled by the retry mechanism</li><li><code>on_giveup</code>, that specifies a callable to use in case of exceeding the <code>max_tries</code></li></ol><p>One notable change is that <code>max_tries</code> is now annotated as <code>int | DecoratedFunc</code>. This is due to the behavior of using <code>retry</code> without the brackets. In such a scenario, the decorated function is passed as the first argument. For the same reason, <code>if callable(max_tries)</code> line checks whether <code>max_tries</code> is something that can be called. If it is, all of the arguments should use their default values. The decorated function is then saved in a separate variable and at the very end it is directly decorated instead of returning the decorator.</p><p>The remaining two arguments are used in the <code>except</code> clause to add the extra behavior.</p><p>The output of the final <code>retry</code> version is the following:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-plaintext data-lang=plaintext><span style=display:flex><span>Calling to_celsius with 100.0
</span></span><span style=display:flex><span>Calling to_fahrenheit with 40
</span></span><span style=display:flex><span>Calling to_fahrenheit with 50
</span></span><span style=display:flex><span>to_fahrenheit failed with can&#39;t multiply sequence by non-int of type &#39;float&#39;, retrying
</span></span><span style=display:flex><span>Calling to_fahrenheit with 50
</span></span><span style=display:flex><span>Giving up: can&#39;t multiply sequence by non-int of type &#39;float&#39;
</span></span></code></pre></div><p>It demonstrates that both usages of the decorator are working as expected and that the new functionalities are present as well.</p><h2 class="relative group">Summary<div id=summary class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#summary aria-label=Anchor>#</a></span></h2><p>In conclusion, Python decorators offer a versatile way to modify the behavior of Python functions without modifying their original code. Decorators can be used to improve the functionality and maintainability of your Python code if you have a strong understanding of how they work and some common use cases. Decorators can help you build cleaner, more modular, and extensible Python code by harnessing the power of closures and higher-order functions.</p><h2 class="relative group">Sources<div id=sources class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#sources aria-label=Anchor>#</a></span></h2><p>Code examples used in the article can be found here: <a href=https://github.com/tobiwandev/sigma_python target=_blank>
link</a>.</p><p>The biggest inspiration for these articles and source of my knowledge is the <a href=https://www.oreilly.com/library/view/fluent-python-2nd/9781492056348/ target=_blank>Fluent Python</a> book by Luciano Ramalho. I highly encourage you to check it out; you will not be disappointed.</p></div><details style=margin-left:0 class="mt-2 mb-5 overflow-hidden rounded-lg ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5"><summary class="py-1 text-lg font-semibold cursor-pointer bg-primary-200 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-primary-800 dark:text-neutral-100">Sigma Python - This article is part of a series.</summary></details></div><script>var oid="views_articles/sigmapython01/index.md",oid_likes="likes_articles/sigmapython01/index.md"</script><script type=text/javascript src=/js/page.min.f94e5beb747249fb2315a14fc6417e483411d48b59dc1376bbafa8c37fce65d397d5401be15c7461670ec7bb90ac2bf148d7d48eaf02f317cd9dc04d4851fd31.js integrity="sha512-+U5b63RySfsjFaFPxkF+SDQR1ItZ3BN2u6+ow3/OZdOX1UAb4Vx0YWcOx7uQrCvxSNfUjq8C8xfNncBNSFH9MQ=="></script></section><footer class="pt-8 max-w-prose print:hidden"></footer></article><div id=top-scroller class="pointer-events-none absolute top-[110vh] bottom-0 w-12 ltr:right-0 rtl:left-0"><a href=#the-top class="pointer-events-auto sticky top-[calc(100vh-5.5rem)] flex h-12 w-12 mb-16 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 backdrop-blur hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400" aria-label="Scroll to top" title="Scroll to top">&uarr;</a></div></main><footer id=site-footer class="py-10 print:hidden"><div class="flex items-center justify-between"><p class="text-sm text-neutral-500 dark:text-neutral-400">&copy;
2024
Piotr Tobiasz</p><p class="text-xs text-neutral-500 dark:text-neutral-400">Powered by <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://gohugo.io/ target=_blank rel="noopener noreferrer">Hugo</a> & <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://blowfish.page/ target=_blank rel="noopener noreferrer">Blowfish</a></p></div><script>mediumZoom(document.querySelectorAll("img:not(.nozoom)"),{margin:24,background:"rgba(0,0,0,0.5)",scrollOffset:0})</script><script type=text/javascript src=/js/process.min.ee03488f19c93c2efb199e2e3014ea5f3cb2ce7d45154adb3399a158cac27ca52831db249ede5bb602700ef87eb02434139de0858af1818ab0fb4182472204a4.js integrity="sha512-7gNIjxnJPC77GZ4uMBTqXzyyzn1FFUrbM5mhWMrCfKUoMdsknt5btgJwDvh+sCQ0E53ghYrxgYqw+0GCRyIEpA=="></script></footer><div id=search-wrapper class="invisible fixed inset-0 flex h-screen w-screen cursor-default flex-col bg-neutral-500/50 p-4 backdrop-blur-sm dark:bg-neutral-900/50 sm:p-6 md:p-[10vh] lg:p-[12vh]" data-url=https://tobiwandev.github.io/ style=z-index:500><div id=search-modal class="flex flex-col w-full max-w-3xl min-h-0 mx-auto border rounded-md shadow-lg top-20 border-neutral-200 bg-neutral dark:border-neutral-700 dark:bg-neutral-800"><header class="relative z-10 flex items-center justify-between flex-none px-2"><form class="flex items-center flex-auto min-w-0"><div class="flex items-center justify-center w-8 h-8 text-neutral-400"><span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></div><input type=search id=search-query class="flex flex-auto h-12 mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent" placeholder=Search tabindex=0></form><button id=close-search-button class="flex items-center justify-center w-8 h-8 text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400" title="Close (Esc)">
<span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentcolor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></button></header><section class="flex-auto px-2 overflow-auto"><ul id=search-results></ul></section></div></div></div></body></html>